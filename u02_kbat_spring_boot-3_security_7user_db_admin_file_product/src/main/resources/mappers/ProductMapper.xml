<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.kbat.ex.mapper.NBoardAndMemberMapper">
	
	<resultMap id="ProductMap" type="edu.kbat.ex.vo.ProductVO">
		<result property="category_id" column="category_id"/>
		<result property="category_name" column="category_name"/>
		<result property="category_parent" column="category_parent"/>
		<result property="product_id" column="product_id"/>
		<result property="product_name" column="product_name"/>
		<result property="product_price" column="product_price"/>
		<result property="product_enable" column="product_enable"/>
		<result property="product_date" column="product_date"/>
		<result property="product_stock" column="product_stock"/>
		<result property="product_description" column="product_description"/>
		<result property="video_id" column="video_id"/>
		<result property="video_name" column="video_name"/>
		<result property="image_id" column="image_id"/>
		<result property="image_name" column="image_name"/>
	</resultMap>
	
	<select id="getList" resultMap = "ProductMap">
		<![CDATA[ 
				select 
					category.category_id as category_id,
					category.category_name as category_name,
					category.category_parent as category_parent,
					product.product_id as product_id,
					product.product_name as product_name,
					product.product_price as product_price,
					product.product_enable as product_enable,
					product.product_date as product_date,
					product.product_stock as product_stock,
					product.product_description as product_description,
					video.video_id as video_id,
					video.video_name as video_name,
					image.image_id as image_id,
					image.image_name as image_name
				from 
					category,
					product,
					video,
					image 
				where 
					category.category_id = product.category_id 
					and 
					product.product_id = video.product_id 
					and 
					product.product_id = image.product_id 
					order by 
					product.product_id;
		]]>
	
	</select>
	
	<select id="getboardtypeList" resultMap = "nBoardMap">
   				
   				
   		<![CDATA[ select * from boardtype,board,member where board.boardtype_id = boardtype.boardtype_id and board.boardtype_id = 0 and member.member_number =board.member_number order by board_id
   		]]>
   		
   	</select>
   	
   	<select id="read" resultType="edu.kbat.ex.vo.NBoardVO">
   		<![CDATA[
      		select * from board where board_id = #{board_id}
   		]]>
   	</select>
   	
    <insert id="write" >
   		<![CDATA[
     		insert into board (board_id, board_title, board_content) 
      		values (board_seq.nextval, #{board_title}, #{board_content}) 
  		]]>
    </insert>  
    
    <update id="modify">
   		<![CDATA[
      		update board set board_title = #{board_title}, board_content = #{board_content} where board_id = #{board_id}      
   		]]>
    </update> 
    
    <update id="hit">
   		<![CDATA[
     		update board set board_hit = board_hit+1 where board_id = #{board_id}
   		]]>
    </update>  
    
    <delete id="delete">
   		<![CDATA[
      		delete from board where board_id = #{board_id}
   		]]>
    </delete>
    
    <select id="getTotalCount" resultType = "int">
	<![CDATA[
		select count(*) from board where boardtype_id = '0'
	]]>
	</select>
	
	<!-- 	열개씩 뽑아내는거 한페이지에 출력해주는 역할 -->
	<!-- <select id="getListWithPaging" resultType = "edu.kbat.ex.vo.NBoardVO"> -->
	<select id="getListWithPaging" resultMap = "nBoardMap">
	<![CDATA[
		         SELECT * FROM (
              SELECT ROWNUM AS RNUM, A.* FROM (
												select
													boardtype.boardtype_id,
													boardtype.boardtype_name,
													member.member_number,
													member.member_id,
													member.password,
													member.member_name,
													member.member_phone,
													member.member_email,
													member.member_address,
													member.member_company,
													board.board_id,
													board.board_title,
													board.board_content,
													board.board_date,
													board.board_hit
												from boardtype, board, member 
												where 
													board.boardtype_id = boardtype.boardtype_id 
													and board.boardtype_id = 0 
													and member.member_number =board.member_number 
												order by board_id
												
             ) A WHERE ROWNUM <= #{pageNum} * #{amount}
         ) WHERE RNUM > (#{pageNum}-1) * #{amount}		
	]]>
	</select>
	 
</mapper>
